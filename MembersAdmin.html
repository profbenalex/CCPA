<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="UTF-8">
    <title>CCPA Members ADMIN</title>
    <style>
    body {
      font-family: Arial, sans-serif;
      font-size: 14px;
      margin: 0;
      background-color: #f4f4f4;
    }
    #logo {
      text-align: center;
      background-color: #ffffff;
    }
    #logo img {
      width: 100%;
      height: 80px;
      object-fit: cover;
    }
    #banner {
      background-color: #0078D7;
      color: white;
      text-align: center;
      padding: 12px 0;
      font-size: 22px;
      font-weight: bold;
    }
    #container {
      max-width: 1000px;
      margin: auto;
      padding: 30px;
    }
    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
      font-size: 14px;
    }
    select, input, textarea, button {
      width: 100%;
      padding: 10px;
      margin-top: 4px;
      font-size: 14px;
      box-sizing: border-box;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 30px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px 10px;
      text-align: left;
      font-size: 14px;
    }
    th {
      background-color: #0078D7;
      color: white;
    }
    #editFormContainer,
    #addFormContainer,
    #deleteFormContainer {
      margin-top: 20px;
      padding: 20px;
      border: 1px solid #ccc;
      background: #ffffff;
    }
    #selectorRow {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 10px;
    }
    #claimSelector {
      flex-grow: 1;
    }
    #printButton {
      white-space: nowrap;
      background-color: #0078D7;
      color: white;
      border: none;
      padding: 10px 14px;
      cursor: pointer;
      font-size: 14px;
    }
    #printButton:hover {
      background-color: #005a9e;
    }
  </style>
  </head>
  <body>
    <!-- PART II -->
    <!-- Section 1: Logo and Banner -->
    <div id="logo"><img src="Crawford.jpg" alt="Crawford Logo"></div>
    <div id="banner">Members Register - Administration Version 1.0</div>
    <div id="container">
      <!-- Section 2: Claim Reference Dropdown & Print Button -->
      <h2>üéØ Select Claim Reference</h2>
      <div id="selectorRow">
        <select id="claimSelector">
          <option value="ALL" selected="selected">ALL Members</option>
          <option value="REPS">Claim Representatives ONLY</option>
          <option value="A27|AdamsI">A27 AdamsI</option>
          <option value="A460|AdamsMF">A460 AdamsMF</option>
          <option value="A625|AdamH">A625 AdamH</option>
          <option value="A661|ArnoldF">A661 ArnoldF</option>
          <option value="A679|AlexanderJJ">A679 AlexanderJJ</option>
          <option value="A88|AbrahamsK">A88 AbrahamsK</option>
          <option value="B321|BenjaminWC">B321 BenjaminWC</option>
          <option value="G126|GallantH">G126 GallantH</option>
          <option value="G32|GirieE">G32 GirieE</option>
          <option value="G34|GabrielL">G34 GabrielL</option>
          <option value="H238|HlokoanaR">H238 HlokoanaR</option>
          <option value="H425|Hoosain">H425 Hoosain</option>
          <option value="H431|HassanA">H431 HassanA</option>
          <option value="J101|JacobsR">J101 JacobsR</option>
          <option value="J159|JohnstonAK">J159 JohnstonAK</option>
          <option value="J63|JansenS">J63 JansenS</option>
          <option value="K392|KamaloodienR">K392 KamaloodienR</option>
          <option value="K85|Klaaste &amp; St Clair">K85 Klaaste &amp;
            St Clair</option>
          <option value="L110|LowersCE">L110 LowersCE</option>
          <option value="M2116|MatiZ">M2116 MatiZ</option>
          <option value="N20|NellS">N20 NellS</option>
          <option value="N23|NeumanH">N23 NeumanH</option>
          <option value="O20|OliverBS">O20 OliverBS</option>
          <option value="O51|OsmanE">O51 OsmanE</option>
          <option value="S1404|SibekoY">S1404 SibekoY</option>
          <option value="S250|SiljeurRS">S250 SiljeurRS</option>
          <option value="S426|SamsodienA">S426 SamsodienA</option>
          <option value="S457A|MtwanaJ">S457A MtwanaJ</option>
          <option value="S713|SuleloS">S713 SuleloS</option>
          <option value="S840|SadienD">S840 SadienD</option>
          <option value="S881|SplintersP">S881 SplintersP</option>
          <option value="T62|TaliepMS">T62 TaliepMS</option>
          <option value="V202|Van Der Schyff">V202 Van Der Schyff</option>
          <option value="W18|Brache &amp; Michaels">W18 Brache &amp;
            Michaels</option>
        </select>
        <button id="printButton" onclick="printFilteredMembers()">üñ®Ô∏è
          Print Filtered Member List</button> </div>
      <!-- Section 3: Filtered Member Table -->
      <table id="memberTable">
        <thead> <tr>
            <th>#</th>
            <th>Claim Ref</th>
            <th>Claim Name</th>
            <th>Surname</th>
            <th>First Names</th>
            <th>Identity</th>
            <th>Provenance</th>
            <th>Type</th>
            <th>Share</th>
            <th>WhatsApp</th>
            <th>Email</th>
            <th>Address</th>
            <th>Legal Docs</th>
            <th>Notes</th>
          </tr>
        </thead> <tbody>
        </tbody>
      </table>
      <!-- PART III -->
      <!-- Section 4: ‚úèÔ∏è Edit Member by Index -->
      <h2>‚úèÔ∏è Edit Member by Index</h2>
      <label for="editIndex">Enter Index (filtered):</label> <input
        id="editIndex" min="1" placeholder="e.g. 2" type="number"> <label
        for="editPasscode">Enter Passcode:</label> <input
        id="editPasscode" placeholder="" type="password"> <button
        onclick="loadMemberForEdit()">Load Member</button>
      <div id="editFormContainer" style="display:none;">
        <form id="editForm"> <label for="editClaimReference">Claim
            Reference:</label> <input id="editClaimReference"
            required="" type="text"> <label for="editClaimName">Claim
            Name:</label> <input id="editClaimName" required=""
            type="text"> <label for="editSurname">Surname:</label> <input
            id="editSurname" required="" type="text"> <label
            for="editFirstnames">First Names:</label> <input
            id="editFirstnames" required="" type="text"> <label
            for="editIdentity">Identity Number:</label> <input
            id="editIdentity" type="text"> <label for="editProvenance">Provenance:</label>
          <select id="editProvenance">
            <option selected="selected">Unspecified</option>
            <option>Restitution</option>
            <option>Cession</option>
            <option>Purchase</option>
            <option>Inheritance by Will</option>
            <option>Inheritance Intestate</option>
            <option>Customary Succession</option>
            <option>Power of Attorney</option>
          </select>
          <label for="editType">Member Type:</label>
          <select id="editType">
            <option selected="selected">Unspecified</option>
            <option>Ordinary Member</option>
            <option>Claim Representative</option>
          </select>
          <label for="editShareFraction">Share Fraction:</label> <input
            id="editShareFraction" type="text"> <label
            for="editWhatsapp">WhatsApp Number:</label> <input
            id="editWhatsapp" type="text"> <label for="editEmail">Email
            Address:</label> <input id="editEmail" type="email"> <label
            for="editAddress">Physical Address:</label> <textarea id="editAddress" rows="3"></textarea>
          <label for="editLegaldocs">Legal Docs:</label>
          <select id="editLegaldocs">
            <option selected="selected">Nothing Yet</option>
            <option>Some Docs Received</option>
            <option>All Docs Received</option>
          </select>
          <label for="editNotes">Member Notes:</label> <textarea id="editNotes" rows="3"></textarea>
          <button type="submit">Save Changes</button> </form>
      </div>
      <!-- Section 5: ‚ûï Add a New Member -->
      <h2>‚ûï Add a New Member</h2>
      <form id="addForm"> <label for="addClaimReference">Claim
          Reference:</label> <input id="addClaimReference" required=""
          readonly="readonly" type="text"> <label for="addClaimName">Claim




          Name:</label> <input id="addClaimName" required=""
          readonly="readonly" type="text"> <label for="addSurname">Surname:</label>
        <input id="addSurname" required="" type="text"> <label
          for="addFirstnames">First Names:</label> <input
          id="addFirstnames" required="" type="text"> <label
          for="addIdentity">Identity Number:</label> <input
          id="addIdentity" type="text"> <label for="addProvenance">Provenance:</label>
        <select id="addProvenance">
          <option selected="selected">Unspecified</option>
          <option>Restitution</option>
          <option>Cession</option>
          <option>Purchase</option>
          <option>Inheritance by Will</option>
          <option>Inheritance Intestate</option>
          <option>Customary Succession</option>
          <option>Power of Attorney</option>
        </select>
        <label for="addType">Member Type:</label>
        <select id="addType">
          <option selected="selected">Unspecified</option>
          <option>Ordinary Member</option>
          <option>Claim Representative</option>
        </select>
        <label for="addShareFraction">Share Fraction:</label> <input
          id="addShareFraction" type="text"> <label for="addWhatsapp">WhatsApp




          Number:</label> <input id="addWhatsapp" type="text"> <label
          for="addEmail">Email Address:</label> <input id="addEmail"
          type="email"> <label for="addAddress">Physical Address:</label>
        <textarea id="addAddress" rows="3"></textarea> <label
          for="addLegaldocs">Legal Docs:</label>
        <select id="addLegaldocs">
          <option selected="selected">Nothing Yet</option>
          <option>Some Docs Received</option>
          <option>All Docs Received</option>
        </select>
        <label for="addNotes">Member Notes:</label> <textarea id="addNotes" rows="3"></textarea>
        <button type="submit">Add Member</button> </form>
      <!-- Section 6: üóëÔ∏è Delete Member by Index -->
      <h2>üóëÔ∏è Delete Member by Index</h2>
      <div id="deleteFormContainer"> <label for="deleteIndex">Enter
          Index (filtered):</label> <input id="deleteIndex" min="1"
          placeholder="e.g. 4" type="number"> <label
          for="deletePasscode">Enter Passcode:</label> <input
          id="deletePasscode" type="password"> <button
          onclick="deleteMember()">Delete Member</button> </div>
      <!-- PART IV -->
      <script>
document.addEventListener("DOMContentLoaded", function () {
  const API = "https://api.sheety.co/9e808d4656db0991ecb346916d7717e4/crawfordRegister/memberData";
  let allMembers = [], filteredMembers = [];

  function loadMembers() {
    fetch(API)
      .then(res => res.json())
      .then(data => {
        allMembers = data.memberData;
        applyFilter();
      });
  }

  function applyFilter() {
    const val = document.getElementById("claimSelector").value;
    const tbody = document.querySelector("#memberTable tbody");
    tbody.innerHTML = "";

    if (val === "REPS") {
      filteredMembers = allMembers.filter(m => m.mType === "Claim Representative");
    } else if (val !== "ALL") {
      const [ref] = val.split("|");
      filteredMembers = allMembers.filter(m => m.claimReference === ref);
    } else {
      filteredMembers = [...allMembers];
    }

    filteredMembers.forEach((m, i) => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${i + 1}</td>
        <td>${m.claimReference || ""}</td>
        <td>${m.claimName || ""}</td>
        <td>${m.mSurname || ""}</td>
        <td>${m.mFirstnames || ""}</td>
        <td>${m.mIdentity || ""}</td>
        <td>${m.mProvenance || ""}</td>
        <td>${m.mType || ""}</td>
        <td>${m.shareFraction || ""}</td>
        <td>${m.mWhatsapp || ""}</td>
        <td>${m.mEmail || ""}</td>
        <td>${m.mAddress || ""}</td>
        <td>${m.mLegaldocs || "Nothing Yet"}</td>
        <td>${m.mNotes || ""}</td>`;
      tbody.appendChild(row);
    });
  }

  document.getElementById("claimSelector").addEventListener("change", () => {
    const selected = document.getElementById("claimSelector").value;
    const refField = document.getElementById("addClaimReference");
    const nameField = document.getElementById("addClaimName");

    if (selected === "ALL" || selected === "REPS") {
      refField.value = "";
      nameField.value = "";
    } else {
      const [ref, name] = selected.split("|");
      refField.value = ref || "";
      nameField.value = name || "";
    }

    applyFilter();
  });

  document.getElementById("addForm").addEventListener("submit", function (e) {
    e.preventDefault();
    const newMember = {
      memberdatum: {
        claimReference: document.getElementById("addClaimReference").value.trim(),
        claimName: document.getElementById("addClaimName").value.trim(),
        mSurname: document.getElementById("addSurname").value.trim(),
        mFirstnames: document.getElementById("addFirstnames").value.trim(),
        mIdentity: document.getElementById("addIdentity").value.trim(),
        mProvenance: document.getElementById("addProvenance").value,
        mType: document.getElementById("addType").value,
        shareFraction: document.getElementById("addShareFraction").value.trim(),
        mWhatsapp: document.getElementById("addWhatsapp").value.trim(),
        mEmail: document.getElementById("addEmail").value.trim(),
        mAddress: document.getElementById("addAddress").value.trim(),
        mLegaldocs: document.getElementById("addLegaldocs").value || "Nothing Yet",
        mNotes: document.getElementById("addNotes").value.trim()
      }
    };

    fetch(API, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(newMember)
    })
    .then(res => {
      if (res.ok) {
        alert("‚úÖ Member added!");
        document.getElementById("addForm").reset();
        loadMembers();
      } else {
        res.text().then(txt => alert("‚ùå Error: " + txt));
      }
    })
    .catch(() => alert("‚ö†Ô∏è Network error"));
  });

  window.loadMemberForEdit = function () {
    const idx = parseInt(document.getElementById("editIndex").value);
    const pass = document.getElementById("editPasscode").value.trim();

    if (pass !== "DoubleChecked") return alert("üîê Incorrect passcode.");
    if (isNaN(idx) || idx < 1 || idx > filteredMembers.length) return alert("‚ö†Ô∏è Invalid index.");

    const m = filteredMembers[idx - 1];
    document.getElementById("editFormContainer").style.display = "block";

    document.getElementById("editClaimReference").value = m.claimReference || "";
    document.getElementById("editClaimName").value = m.claimName || "";
    document.getElementById("editSurname").value = m.mSurname || "";
    document.getElementById("editFirstnames").value = m.mFirstnames || "";
    document.getElementById("editIdentity").value = m.mIdentity || "";
    document.getElementById("editProvenance").value = m.mProvenance || "Unspecified";
    document.getElementById("editType").value = m.mType || "Unspecified";
    document.getElementById("editShareFraction").value = m.shareFraction || "";
    document.getElementById("editWhatsapp").value = m.mWhatsapp || "";
    document.getElementById("editEmail").value = m.mEmail || "";
    document.getElementById("editAddress").value = m.mAddress || "";
    document.getElementById("editLegaldocs").value = m.mLegaldocs || "Nothing Yet";
    document.getElementById("editNotes").value = m.mNotes || "";

    document.getElementById("editForm").onsubmit = function (e) {
      e.preventDefault();
      const updated = {
        memberdatum: {
          claimReference: document.getElementById("editClaimReference").value.trim(),
          claimName: document.getElementById("editClaimName").value.trim(),
          mSurname: document.getElementById("editSurname").value.trim(),
          mFirstnames: document.getElementById("editFirstnames").value.trim(),
          mIdentity: document.getElementById("editIdentity").value.trim(),
          mProvenance: document.getElementById("editProvenance").value,
          mType: document.getElementById("editType").value,
          shareFraction: document.getElementById("editShareFraction").value.trim(),
          mWhatsapp: document.getElementById("editWhatsapp").value.trim(),
          mEmail: document.getElementById("editEmail").value.trim(),
          mAddress: document.getElementById("editAddress").value.trim(),
          mLegaldocs: document.getElementById("editLegaldocs").value.trim(),
          mNotes: document.getElementById("editNotes").value.trim()
        }
      };

      fetch(`${API}/${m.id}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(updated)
      })
      .then(res => {
        if (res.ok) {
          alert("‚úÖ Member updated!");
          document.getElementById("editForm").reset();
          document.getElementById("editFormContainer").style.display = "none";
          loadMembers();
        } else {
          res.text().then(txt => alert("‚ùå Error: " + txt));
        }
      })
      .catch(() => alert("‚ö†Ô∏è Network error"));
    };
  };

  window.deleteMember = function () {
    const idx = parseInt(document.getElementById("deleteIndex").value);
    const pass = document.getElementById("deletePasscode").value.trim();

    if (pass !== "DoubleChecked") return alert("üîê Incorrect passcode.");
    if (isNaN(idx) || idx < 1 || idx > filteredMembers.length) return alert("‚ö†Ô∏è Invalid index.");

    const member = filteredMembers[idx - 1];
    if (!confirm(`Are you sure you want to permanently delete ${member.mSurname}?`)) return;

    fetch(`${API}/${member.id}`, { method: "DELETE" })
      .then(res => {
        if (res.ok) {
          alert("üóëÔ∏è Member deleted.");
          loadMembers();
        } else {
          res.text().then(msg => alert("‚ùå Deletion failed: " + msg));
        }
      })
      .catch(() => alert("‚ö†Ô∏è Network error"));
  };

<!-- PART V -->

  window.printFilteredMembers = function () {
    let printableHTML = `
      <html><head><title>Filtered Member List</title>
      <style>
        body { font-family: Arial, sans-serif; font-size: 14px; padding: 20px; }
        h2 { font-size: 18px; margin-bottom: 20px; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ccc; padding: 6px; text-align: left; font-size: 14px; }
        th { background-color: #0078D7; color: white; }
      </style>
      </head><body>
      <h2>Filtered Members</h2>
      <table><thead><tr>
        <th>#</th><th>Claim Ref</th><th>Claim Name</th><th>Surname</th><th>First Names</th>
        <th>Identity</th><th>Provenance</th><th>Type</th><th>Share</th><th>WhatsApp</th>
        <th>Email</th><th>Address</th><th>Legal Docs</th><th>Notes</th>
      </tr></thead><tbody>`;

    filteredMembers.forEach((m, i) => {
      printableHTML += `<tr>
        <td>${i + 1}</td>
        <td>${m.claimReference || ""}</td>
        <td>${m.claimName || ""}</td>
        <td>${m.mSurname || ""}</td>
        <td>${m.mFirstnames || ""}</td>
        <td>${m.mIdentity || ""}</td>
        <td>${m.mProvenance || ""}</td>
        <td>${m.mType || ""}</td>
        <td>${m.shareFraction || ""}</td>
        <td>${m.mWhatsapp || ""}</td>
        <td>${m.mEmail || ""}</td>
        <td>${m.mAddress || ""}</td>
        <td>${m.mLegaldocs || ""}</td>
        <td>${m.mNotes || ""}</td>
      </tr>`;
    });

    printableHTML += `</tbody></table></body></html>`;

    const win = window.open('', '', 'height=700,width=1000');
    win.document.write(printableHTML);
    win.document.close();
    win.focus();
    win.print();
  };

  loadMembers();
});
</script></div>
  </body>
</html>
