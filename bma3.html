<!DOCTYPE html>
<html>
<head>
  <title>CCPA Members Register</title>
</head>
<body>
  <h2>CCPA Members Register</h2>

  <button onclick="handleAuthClick()">Authorize</button>
  <button onclick="listData()">Read Sheet</button>
  <button onclick="appendRow()">Add Row</button>

  <pre id="output"></pre>

  <script src="https://apis.google.com/js/api.js"></script>
  <script>
    const CLIENT_ID = '290713393187-sfvukqfmffktomufhtuknnvcjk55e3a8.apps.googleusercontent.com';
    const API_KEY = '';  // Not needed for Sheets read/write via OAuth
    const SPREADSHEET_ID = '1FUzgEatxn_pr2LkqDdRq0m0kPC6zsX0T0J3-MBifqD4';
    const SHEET_NAME = 'register';

    const DISCOVERY_DOC = 'https://sheets.googleapis.com/$discovery/rest?version=v4';
    const SCOPES = 'https://www.googleapis.com/auth/spreadsheets';

    function gapiLoaded() {
      gapi.load('client:auth2', initializeGapiClient);
    }

    async function initializeGapiClient() {
      await gapi.client.init({
        apiKey: API_KEY,
        clientId: CLIENT_ID,
        discoveryDocs: [DISCOVERY_DOC],
        scope: SCOPES,
      });
      document.getElementById('output').innerText = 'GAPI initialized.';
    }

    function handleAuthClick() {
      gapi.auth2.getAuthInstance().signIn();
    }

    async function listData() {
      try {
        const response = await gapi.client.sheets.spreadsheets.values.get({
          spreadsheetId: SPREADSHEET_ID,
          range: SHEET_NAME + '!A1:N', // covers your 14 columns
        });
        const rows = response.result.values;
        if (rows.length) {
          document.getElementById('output').innerText = rows.map(r => r.join(' | ')).join('\n');
        } else {
          document.getElementById('output').innerText = 'No data found.';
        }
      } catch (err) {
        document.getElementById('output').innerText = 'Error: ' + err.message;
      }
    }

    async function appendRow() {
      const values = [
        [
          "A999 Example", "Example Claim", "Doe", "Jane", "Ordinary Member",
          "1/20", "Restitution", "Pending", "http://doclink", "1234567890123",
          "0712345678", "jane@example.com", "123 Main St", "Test entry"
        ]
      ];
      const body = {
        values: values,
      };
      try {
        const result = await gapi.client.sheets.spreadsheets.values.append({
          spreadsheetId: SPREADSHEET_ID,
          range: SHEET_NAME + '!A:N',
          valueInputOption: 'RAW',
          insertDataOption: 'INSERT_ROWS',
          resource: body,
        });
        document.getElementById('output').innerText = 'Row added.';
      } catch (err) {
        document.getElementById('output').innerText = 'Error: ' + err.message;
      }
    }

    gapiLoaded(); // Trigger load immediately
  </script>
</body>
</html>
