<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>bcquality Sheet Test</title>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <style>
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 1em;
    }
    th, td {
      border: 1px solid #999;
      padding: 0.5em;
      text-align: left;
    }
    th {
      background-color: #f0f0f0;
    }
  </style>
</head>
<body>
  <h2>ğŸ” bcquality Sheet Viewer</h2>
  <button id="authButton">ğŸ” Sign in with Google</button>
  <div id="outputContainer"></div>

  <script>
    const clientId = '566030013012-fp4pfljo6t586lo83dq7cdf7umcs07td.apps.googleusercontent.com';
    const sheetId = '1kSctyDuy35alQsG_vN7FswSs2wKGNmk2T-N1MJWYQvI';
    let tokenClient;
    let accessToken = '';

    document.getElementById("authButton").addEventListener("click", () => {
      tokenClient = google.accounts.oauth2.initTokenClient({
        client_id: clientId,
        scope: 'https://www.googleapis.com/auth/spreadsheets https://www.googleapis.com/auth/drive',
        callback: (tokenResponse) => {
          accessToken = tokenResponse.access_token;
          fetchSheetData();
        },
      });
      tokenClient.requestAccessToken();
    });

    function fetchSheetData() {
      fetch(`https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/documents`, {
        headers: {
          Authorization: `Bearer ${accessToken}`
        }
      })
      .then(res => res.json())
      .then(data => {
        const outputContainer = document.getElementById("outputContainer");
        outputContainer.innerHTML = "";

        if (!data.values || data.values.length === 0) {
          outputContainer.textContent = "No data found.";
          return;
        }

        const table = document.createElement("table");
        const headerRow = document.createElement("tr");

        // Create headers from the first row
        data.values[0].forEach(headerText => {
          const th = document.createElement("th");
          th.textContent = headerText;
          headerRow.appendChild(th);
        });
        table.appendChild(headerRow);

        // Create rows from remaining data
        data.values.slice(1).forEach(row => {
          const tr = document.createElement("tr");
          row.forEach(cell => {
            const td = document.createElement("td");
            td.textContent = cell;
            tr.appendChild(td);
          });
          table.appendChild(tr);
        });

        outputContainer.appendChild(table);
      })
      .catch(err => {
        document.getElementById("outputContainer").textContent = 'âŒ Error: ' + err;
      });
    }
  </script>
</body>
</html>
